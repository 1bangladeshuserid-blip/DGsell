<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DG Marketplace - Premium Social Media Accounts Trading Platform</title>
    
    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            GoogleAuthProvider,
            signInWithPopup,
            updateProfile
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore,
            collection,
            addDoc,
            query,
            where,
            getDocs,
            updateDoc,
            deleteDoc,
            doc,
            serverTimestamp,
            orderBy,
            getDoc,
            setDoc,
            limit
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { 
            getStorage,
            ref,
            uploadBytes,
            getDownloadURL,
            deleteObject
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyABzqSv-pSc26Ny6HcQb66S3Da0-XP4ZDo",
            authDomain: "dg-market-official.firebaseapp.com",
            projectId: "dg-market-official",
            storageBucket: "dg-market-official.firebasestorage.app",
            messagingSenderId: "472340039296",
            appId: "1:472340039296:web:b6247573157d2992348865",
            measurementId: "G-Y761C5MZQH"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
        const googleProvider = new GoogleAuthProvider();

        // Global variables
        let currentUser = null;
        let userRole = null;
        let isAdmin = false;
        const ADMIN_UID = "PKSeq0uhBQcJwEjYCW085jtV24e2";
        let userData = {};
        let userWallet = 0;

        // Auth State Observer
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                // Check if user is admin
                isAdmin = (user.uid === ADMIN_UID);
                
                // Update email display
                document.getElementById('buyerEmail').textContent = user.email;
                document.getElementById('sellerEmail').textContent = user.email;
                document.getElementById('adminEmail').textContent = user.email;
                document.getElementById('profileEmail').textContent = user.email;
                document.getElementById('userEmailMenu').textContent = user.displayName || user.email.split('@')[0];
                
                // Update profile icon
                updateProfileIcon(user.displayName || user.email);
                
                // Show main header
                document.getElementById('mainHeader').style.display = 'flex';
                
                // User is signed in
                if (isAdmin) {
                    show('adminDashboard');
                    loadAdminData();
                    document.getElementById('bottomNav').style.display = 'none';
                    document.getElementById('mobileMenuBtn').style.display = 'none';
                } else {
                    loadUserData(user.uid);
                    document.getElementById('bottomNav').style.display = 'flex';
                    document.getElementById('mobileMenuBtn').style.display = 'block';
                }
            } else {
                // User is signed out
                userRole = null;
                isAdmin = false;
                userData = {};
                userWallet = 0;
                document.getElementById('mainHeader').style.display = 'none';
                document.getElementById('bottomNav').style.display = 'none';
                document.getElementById('mobileMenuBtn').style.display = 'none';
                show('login');
            }
        });

        // Update profile icon with initials
        function updateProfileIcon(name) {
            const profileIcon = document.getElementById('profileIcon');
            const initials = name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
            profileIcon.textContent = initials || 'ðŸ‘¤';
        }

        // Load user data including role and wallet
        async function loadUserData(uid) {
            try {
                const q = query(collection(db, "users"), where("uid", "==", uid));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    querySnapshot.forEach((doc) => {
                        userData = doc.data();
                        userRole = userData.role;
                        userWallet = userData.wallet || 0;
                        
                        // Update wallet display
                        document.getElementById('walletBalance').textContent = formatIndianCurrency(userWallet);
                        document.getElementById('profileWallet').textContent = formatIndianCurrency(userWallet);
                        document.getElementById('profileWalletDisplay').textContent = formatIndianCurrency(userWallet);
                        
                        // Update profile info
                        document.getElementById('profileRole').textContent = userRole || 'Not set';
                        if (userData.name) {
                            document.getElementById('profileName').value = userData.name;
                            updateProfileIcon(userData.name);
                        }
                        if (userData.phone) {
                            document.getElementById('profilePhone').value = userData.phone;
                        }
                        
                        // Show appropriate dashboard based on role
                        if (userRole === 'Buyer') {
                            show('buyerDashboard');
                            loadListings();
                        } else if (userRole === 'Seller') {
                            show('sellerDashboard');
                            loadMyListings();
                        }
                    });
                } else {
                    console.log("No user data found");
                    // If user signed in with Google and no role assigned, ask for role
                    if (currentUser) {
                        show('roleSelector');
                    } else {
                        signOut(auth);
                    }
                }
            } catch (error) {
                console.error("Error loading user data: ", error);
            }
        }

        // Format Indian currency
        function formatIndianCurrency(amount) {
            return 'â‚¹' + amount.toLocaleString('en-IN', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        // UI Navigation
        window.show = (id) => {
            document.querySelectorAll('.card, .dashboard, .role-selector').forEach(e => e.style.display = "none");
            const element = document.getElementById(id);
            if (element) {
                element.style.display = "block";
            }
            // Update bottom nav active state
            updateBottomNavActiveState(id);
        }

        // Update bottom navigation active state
        function updateBottomNavActiveState(currentScreen) {
            document.querySelectorAll('.bottom-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            if (currentScreen === 'buyerDashboard' || currentScreen === 'sellerDashboard') {
                document.querySelector('[onclick="show(\'buyerDashboard\')"]')?.classList.add('active');
            } else if (currentScreen === 'history') {
                document.querySelector('[onclick="show(\'history\')"]')?.classList.add('active');
            } else if (currentScreen === 'profile') {
                document.querySelector('[onclick="show(\'profile\')"]')?.classList.add('active');
            } else if (currentScreen === 'supportPage') {
                document.querySelector('[onclick="show(\'supportPage\')"]')?.classList.add('active');
            }
        }

        // Toggle mobile menu
        window.toggleMenu = () => {
            const menu = document.getElementById('mobileMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        // Close mobile menu
        window.closeMenu = () => {
            document.getElementById('mobileMenu').style.display = 'none';
        }

        // Email Validation
        function validEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        // SIGNUP Function
        window.signup = async () => {
            let email = document.getElementById('smail').value.trim();
            let pass = document.getElementById('spass').value;
            let name = document.getElementById('sname').value.trim();
            let role = document.querySelector('input[name="role"]:checked');

            if (!name) return alert("Please enter your full name!");
            if (!validEmail(email)) return alert("Please enter a valid email address!");
            if (pass.length < 6) return alert("Password must be at least 6 characters!");
            if (!role) return alert("Please select Buyer or Seller role!");

            try {
                const signupBtn = document.querySelector('#signup button[onclick="signup()"]');
                const originalText = signupBtn.innerHTML;
                signupBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Account...';
                signupBtn.disabled = true;

                // Create user in Firebase Auth
                const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                const user = userCredential.user;
                
                // Update profile with name
                await updateProfile(user, {
                    displayName: name
                });

                // Store user data in Firestore
                await addDoc(collection(db, "users"), {
                    uid: user.uid,
                    email: email,
                    name: name,
                    role: role.value,
                    wallet: 0,
                    createdAt: serverTimestamp(),
                    status: 'active',
                    kycVerified: false,
                    lastLogin: serverTimestamp()
                });

                signupBtn.innerHTML = originalText;
                signupBtn.disabled = false;

                alert("Account created successfully! Welcome to DG Marketplace.");
                userRole = role.value;
                
                // Show appropriate dashboard
                if (role.value === 'Buyer') {
                    show('buyerDashboard');
                    loadListings();
                } else {
                    show('sellerDashboard');
                }
            } catch (error) {
                alert("Registration error: " + error.message);
                const signupBtn = document.querySelector('#signup button[onclick="signup()"]');
                signupBtn.innerHTML = 'Create Account';
                signupBtn.disabled = false;
            }
        }

        // LOGIN Function
        window.login = async () => {
            let email = document.getElementById('lmail').value;
            let pass = document.getElementById('lpass').value;

            if (!email || !pass) {
                return alert("Please enter email and password!");
            }

            try {
                const loginBtn = document.querySelector('#login button[onclick="login()"]');
                const originalText = loginBtn.innerHTML;
                loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';
                loginBtn.disabled = true;

                await signInWithEmailAndPassword(auth, email, pass);
                
                loginBtn.innerHTML = originalText;
                loginBtn.disabled = false;
            } catch (error) {
                alert("Login failed: " + error.message);
                const loginBtn = document.querySelector('#login button[onclick="login()"]');
                loginBtn.innerHTML = 'Sign In';
                loginBtn.disabled = false;
            }
        }

        // GOOGLE LOGIN/SIGNUP Function
        window.googleLogin = async () => {
            try {
                const result = await signInWithPopup(auth, googleProvider);
                const user = result.user;
                
                // Check if user exists in Firestore
                const q = query(collection(db, "users"), where("uid", "==", user.uid));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    // New Google user - show role selector
                    show('roleSelector');
                } else {
                    // Existing user - load their data
                    loadUserData(user.uid);
                }
            } catch (error) {
                console.error("Google signin error: ", error);
                alert("Google signin error: " + error.message);
            }
        }

        // Save role for Google users
        window.saveGoogleUserRole = async () => {
            if (!currentUser) {
                alert("No user found. Please login again.");
                return;
            }

            const role = document.querySelector('input[name="googleRole"]:checked');
            if (!role) return alert("Please select Buyer or Seller!");

            try {
                // Store user data in Firestore
                await addDoc(collection(db, "users"), {
                    uid: currentUser.uid,
                    email: currentUser.email,
                    name: currentUser.displayName || currentUser.email.split('@')[0],
                    role: role.value,
                    wallet: 0,
                    createdAt: serverTimestamp(),
                    status: 'active',
                    kycVerified: false,
                    lastLogin: serverTimestamp()
                });

                userRole = role.value;
                alert("Account setup complete! Welcome to DG Marketplace.");
                
                // Show appropriate dashboard
                if (role.value === 'Buyer') {
                    show('buyerDashboard');
                    loadListings();
                } else {
                    show('sellerDashboard');
                }
            } catch (error) {
                alert("Error saving role: " + error.message);
            }
        }

        // LOGOUT Function
        window.logout = async () => {
            try {
                await signOut(auth);
                alert("Logged out successfully!");
                show('login');
            } catch (error) {
                alert("Logout error: " + error.message);
            }
        }

        // ADD FUNDS Function
        window.addFunds = async () => {
            const amount = parseFloat(document.getElementById('addAmount').value);
            if (!amount || amount <= 0) {
                return alert("Please enter a valid amount!");
            }
            
            // Load payment settings
try {
    // à¤¹à¤®à¥‡à¤¶à¤¾ fixed UPI ID use à¤•à¤°à¥‡à¤‚
    const fixedUpiId = "7775965170@naviaxis";
    
    // Show payment page with Indian UPI QR
    document.getElementById('paymentAmount').textContent = formatIndianCurrency(amount);
    document.getElementById('paymentUpiId').textContent = fixedUpiId;
    
    // Generate UPI payment URL with FIXED UPI ID
    const upiUrl = `upi://pay?pa=7775965170@naviaxis&pn=DG%20Marketplace&am=${amount}&tn=Add%20Funds%20for%20${currentUser.email}&cu=INR`;
    
    // Generate QR Code for FIXED UPI ID
    const qrContainer = document.getElementById('qrCode');
    qrContainer.innerHTML = '';
    
    QRCode.toCanvas(qrContainer, upiUrl, { 
        width: 250, 
        margin: 2,
        color: {
            dark: '#1e3c72',
            light: '#ffffff'
        }
    }, function(error) {
        if (error) console.error(error);
    });
    
    show('paymentPage');
} catch (error) {
    alert("Error loading payment settings: " + error.message);
}

        // Submit payment proof
        window.submitPaymentProof = async () => {
            const amount = parseFloat(document.getElementById('addAmount').value);
            const utr = document.getElementById('utrNumber').value.trim();
            if (!utr) {
                return alert("Please enter UTR/Transaction ID!");
            }
            
            try {
                // Load payment settings for UPI ID
                const docRef = doc(db, "settings", "paymentMethod");
                const docSnap = await getDoc(docRef);
                let upiId = "7775965170@naviaxis";
                
                if (docSnap.exists()) {
                    upiId = docSnap.data().upiId || upiId;
                }
                
                // Create payment request
                await addDoc(collection(db, "paymentRequests"), {
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    userName: userData.name || currentUser.displayName,
                    amount: amount,
                    utr: utr,
                    status: "pending",
                    upiId: upiId,
                    createdAt: serverTimestamp(),
                    processed: false
                });
                
                alert("Payment proof submitted successfully! Admin will verify and add funds within 24 hours.");
                document.getElementById('addAmount').value = '';
                document.getElementById('utrNumber').value = '';
                show('buyerDashboard');
            } catch (error) {
                alert("Error submitting payment proof: " + error.message);
            }
        }

        // WITHDRAW FUNDS Function
        window.withdrawFunds = async () => {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const upiId = document.getElementById('withdrawUpi').value.trim();
            
            if (!amount || amount <= 0) {
                return alert("Please enter a valid amount!");
            }
            
            if (amount > userWallet) {
                return alert("Insufficient balance in wallet!");
            }
            
            if (!upiId || !upiId.includes('@')) {
                return alert("Please enter a valid UPI ID (e.g., username@bank)!");
            }
            
            try {
                // Create withdrawal request
                await addDoc(collection(db, "withdrawalRequests"), {
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    userName: userData.name || currentUser.displayName,
                    amount: amount,
                    upiId: upiId,
                    status: "pending",
                    createdAt: serverTimestamp(),
                    processed: false
                });
                
                alert("Withdrawal request submitted successfully! Admin will process within 24 hours.");
                document.getElementById('withdrawAmount').value = '';
                document.getElementById('withdrawUpi').value = '';
                show('walletPage');
            } catch (error) {
                alert("Error submitting withdrawal request: " + error.message);
            }
        }

        // Show specific category listings
        window.showCategory = (category, type) => {
            if (type === 'sell') {
                document.getElementById('category').value = category;
                document.getElementById('platform').value = category;
                show('sellerDashboard');
                document.getElementById('listingForm').scrollIntoView({ behavior: 'smooth' });
            } else if (type === 'buy') {
                filterListingsByCategory(category);
                show('buyerDashboard');
            }
        }

        // Filter listings by category
        async function filterListingsByCategory(category) {
            const listingsContainer = document.getElementById('listingsContainer');
            if (!listingsContainer) return;

            try {
                const q = query(
                    collection(db, "listings"), 
                    where("status", "==", "Available"),
                    where("approved", "==", true),
                    where("category", "==", category)
                );
                const querySnapshot = await getDocs(q);
                
                listingsContainer.innerHTML = "";
                
                if (querySnapshot.empty) {
                    listingsContainer.innerHTML = `
                        <div class="no-listings">
                            <i class="fas fa-search fa-3x"></i>
                            <h3>No ${category} Listings Available</h3>
                            <p>Check back soon or try another category</p>
                        </div>
                    `;
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const listing = doc.data();
                    listing.id = doc.id;
                    const listingElement = createListingElement(listing);
                    listingsContainer.appendChild(listingElement);
                });
            } catch (error) {
                console.error("Error loading listings: ", error);
                listingsContainer.innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle fa-3x"></i>
                        <h3>Error Loading Listings</h3>
                        <p>Please try again later</p>
                    </div>
                `;
            }
        }

        // SELL NOW - Create Listing
        window.createListing = async () => {
            if (!currentUser || userRole !== 'Seller') {
                alert("Only sellers can create listings!");
                return;
            }

            const category = document.getElementById('category').value;
            const platform = document.getElementById('platform').value;
            const handle = document.getElementById('handle').value;
            const subscribers = document.getElementById('subscribers').value;
            const price = document.getElementById('price').value;
            const description = document.getElementById('description').value;
            const proofImages = document.getElementById('proofImages').files;

            // Validation
            if (!category || !platform || !handle || !subscribers || !price) {
                return alert("Please fill all required fields!");
            }

            if (proofImages.length < 3) {
                return alert("Please upload at least 3 proof images!");
            }

            if (proofImages.length > 7) {
                return alert("Maximum 7 proof images allowed!");
            }

            try {
                const submitBtn = document.querySelector('#listingForm button[type="button"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Listing...';
                submitBtn.disabled = true;

                // Upload images to Firebase Storage
                const imageUrls = [];
                for (let i = 0; i < proofImages.length; i++) {
                    const file = proofImages[i];
                    const storageRef = ref(storage, `listings/${currentUser.uid}/${Date.now()}_${file.name}`);
                    await uploadBytes(storageRef, file);
                    const downloadURL = await getDownloadURL(storageRef);
                    imageUrls.push(downloadURL);
                }

                // Save listing to Firestore
                await addDoc(collection(db, "listings"), {
                    sellerId: currentUser.uid,
                    sellerEmail: currentUser.email,
                    sellerName: userData.name || currentUser.displayName,
                    category: category,
                    platform: platform,
                    handle: handle,
                    subscribers: subscribers,
                    price: parseFloat(price),
                    description: description,
                    imageUrls: imageUrls,
                    status: "Under Review",
                    createdAt: serverTimestamp(),
                    approved: false,
                    featured: false,
                    views: 0
                });

                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;

                alert("Listing submitted successfully! It's now under review by our team.");
                document.getElementById('listingForm').reset();
                loadMyListings();
            } catch (error) {
                alert("Error creating listing: " + error.message);
                const submitBtn = document.querySelector('#listingForm button[type="button"]');
                submitBtn.innerHTML = 'Submit Listing';
                submitBtn.disabled = false;
            }
        }

        // Load all listings for buyers
        async function loadListings() {
            const listingsContainer = document.getElementById('listingsContainer');
            if (!listingsContainer) return;

            try {
                const q = query(
                    collection(db, "listings"), 
                    where("status", "==", "Available"),
                    where("approved", "==", true)
                );
                const querySnapshot = await getDocs(q);
                
                listingsContainer.innerHTML = "";
                
                if (querySnapshot.empty) {
                    listingsContainer.innerHTML = `
                        <div class="no-listings">
                            <i class="fas fa-store-alt fa-3x"></i>
                            <h3>No Listings Available</h3>
                            <p>Be the first to list your social media account!</p>
                        </div>
                    `;
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const listing = doc.data();
                    listing.id = doc.id;
                    const listingElement = createListingElement(listing);
                    listingsContainer.appendChild(listingElement);
                });
            } catch (error) {
                console.error("Error loading listings: ", error);
                listingsContainer.innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle fa-3x"></i>
                        <h3>Error Loading Listings</h3>
                        <p>Please try again later</p>
                    </div>
                `;
            }
        }

        // Load seller's own listings
        async function loadMyListings() {
            const myListingsContainer = document.getElementById('myListingsContainer');
            if (!myListingsContainer || !currentUser) return;

            try {
                const q = query(collection(db, "listings"), where("sellerId", "==", currentUser.uid));
                const querySnapshot = await getDocs(q);
                
                myListingsContainer.innerHTML = "";
                
                if (querySnapshot.empty) {
                    myListingsContainer.innerHTML = `
                        <div class="no-listings">
                            <i class="fas fa-plus-circle fa-3x"></i>
                            <h3>No Listings Yet</h3>
                            <p>Create your first listing to start selling</p>
                        </div>
                    `;
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const listing = doc.data();
                    listing.id = doc.id;
                    const listingElement = createListingElement(listing, true);
                    myListingsContainer.appendChild(listingElement);
                });
            } catch (error) {
                console.error("Error loading my listings: ", error);
                myListingsContainer.innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle fa-3x"></i>
                        <h3>Error Loading Listings</h3>
                        <p>Please try again later</p>
                    </div>
                `;
            }
        }

        // Create HTML element for a listing
        function createListingElement(listing, isSellerView = false) {
            const div = document.createElement('div');
            div.className = 'listing-card';
            
            const firstImage = listing.imageUrls && listing.imageUrls.length > 0 ? listing.imageUrls[0] : '';
            
            div.innerHTML = `
                <div class="listing-image" style="background-image: url('${firstImage}')">
                    <div class="listing-overlay">
                        <span class="image-count"><i class="fas fa-images"></i> ${listing.imageUrls?.length || 0}</span>
                    </div>
                </div>
                <div class="listing-details">
                    <div class="listing-header">
                        <span class="listing-platform">
                            <i class="fab fa-${listing.platform.toLowerCase()}"></i> ${listing.platform}
                        </span>
                        <span class="listing-category">${listing.category}</span>
                        ${listing.featured ? '<span class="featured-badge"><i class="fas fa-star"></i> Featured</span>' : ''}
                    </div>
                    <h3 class="listing-handle"><i class="fas fa-at"></i> ${listing.handle}</h3>
                    <div class="listing-stats">
                        <div class="stat-item">
                            <i class="fas fa-users"></i>
                            <span>${listing.subscribers.toLocaleString()} Followers</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-eye"></i>
                            <span>${listing.views || 0} Views</span>
                        </div>
                    </div>
                    <div class="listing-price">${formatIndianCurrency(listing.price)}</div>
                    <p class="listing-description">${listing.description || 'No description provided'}</p>
                    <div class="listing-seller">
                        <i class="fas fa-user-tag"></i> ${listing.sellerName || 'Seller'}
                    </div>
                    <div class="listing-actions">
                        ${isSellerView ? 
                            `<span class="listing-status ${listing.status.toLowerCase().replace(' ', '-')}">
                                <i class="fas fa-clock"></i> ${listing.status}
                            </span>` : 
                            `<button class="buy-now-btn" onclick="buyNow('${listing.handle}', ${listing.price}, '${listing.id}')">
                                <i class="fas fa-shopping-cart"></i> Buy Now
                            </button>`
                        }
                    </div>
                </div>
            `;
            
            return div;
        }

        // BUY NOW Function
        window.buyNow = async (handle, price, listingId) => {
            if (!currentUser || userRole !== 'Buyer') {
                alert("Only buyers can purchase listings!");
                return;
            }
            
            if (userWallet < price) {
                alert("Insufficient wallet balance! Please add funds first.");
                show('walletPage');
                return;
            }
            
            if (confirm(`Are you sure you want to buy @${handle} for ${formatIndianCurrency(price)}?`)) {
                try {
                    // Create order
                    await addDoc(collection(db, "orders"), {
                        buyerId: currentUser.uid,
                        buyerEmail: currentUser.email,
                        buyerName: userData.name || currentUser.displayName,
                        listingId: listingId,
                        handle: handle,
                        price: price,
                        status: "Processing",
                        paymentStatus: "Completed",
                        createdAt: serverTimestamp(),
                        orderId: 'ORD' + Date.now()
                    });
                    
                    // Deduct from wallet
                    userWallet -= parseFloat(price);
                    await updateUserWallet(currentUser.uid, userWallet);
                    
                    alert("Purchase successful! The seller will contact you shortly for account transfer.");
                } catch (error) {
                    alert("Error creating order: " + error.message);
                }
            }
        }

        // Update user wallet
        async function updateUserWallet(uid, newBalance) {
            try {
                const q = query(collection(db, "users"), where("uid", "==", uid));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    querySnapshot.forEach(async (userDoc) => {
                        await updateDoc(doc(db, "users", userDoc.id), {
                            wallet: newBalance,
                            lastTransaction: serverTimestamp()
                        });
                        
                        // Update display
                        const formattedBalance = formatIndianCurrency(newBalance);
                        document.getElementById('walletBalance').textContent = formattedBalance;
                        document.getElementById('profileWallet').textContent = formattedBalance;
                        document.getElementById('profileWalletDisplay').textContent = formattedBalance;
                        userWallet = newBalance;
                    });
                }
            } catch (error) {
                console.error("Error updating wallet: ", error);
            }
        }

        // UPDATE PROFILE Function
        window.updateProfile = async () => {
            const name = document.getElementById('profileName').value.trim();
            const phone = document.getElementById('profilePhone').value.trim();
            
            if (!name) {
                return alert("Name is required!");
            }
            
            try {
                // Update in Firestore
                const q = query(collection(db, "users"), where("uid", "==", currentUser.uid));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    querySnapshot.forEach(async (userDoc) => {
                        await updateDoc(doc(db, "users", userDoc.id), {
                            name: name,
                            phone: phone || null,
                            updatedAt: serverTimestamp()
                        });
                        
                        // Update Firebase Auth profile
                        await updateProfile(currentUser, {
                            displayName: name
                        });
                        
                        // Update profile icon
                        updateProfileIcon(name);
                        
                        alert("Profile updated successfully!");
                        loadUserData(currentUser.uid);
                    });
                }
            } catch (error) {
                alert("Error updating profile: " + error.message);
            }
        }

        // UPLOAD PROFILE PHOTO Function
        window.uploadProfilePhoto = async () => {
            const fileInput = document.getElementById('profilePhotoUpload');
            const file = fileInput.files[0];
            
            if (!file) {
                return alert("Please select a photo!");
            }
            
            // Check file type
            if (!file.type.startsWith('image/')) {
                return alert("Please select an image file!");
            }
            
            // Check file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                return alert("Image size should be less than 5MB!");
            }
            
            try {
                const uploadBtn = document.querySelector('button[onclick="uploadProfilePhoto()"]');
                const originalText = uploadBtn.innerHTML;
                uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
                
                // Upload to Firebase Storage
                const storageRef = ref(storage, `profile-photos/${currentUser.uid}/${Date.now()}_${file.name}`);
                await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(storageRef);
                
                // Update in Firestore
                const q = query(collection(db, "users"), where("uid", "==", currentUser.uid));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    querySnapshot.forEach(async (userDoc) => {
                        await updateDoc(doc(db, "users", userDoc.id), {
                            profilePhoto: downloadURL,
                            updatedAt: serverTimestamp()
                        });
                        
                        // Update profile icon with photo
                        const profileIcon = document.getElementById('profileIcon');
                        profileIcon.innerHTML = `<img src="${downloadURL}" alt="Profile" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                        
                        uploadBtn.innerHTML = originalText;
                        
                        alert("Profile photo updated successfully!");
                    });
                }
            } catch (error) {
                alert("Error uploading photo: " + error.message);
                const uploadBtn = document.querySelector('button[onclick="uploadProfilePhoto()"]');
                uploadBtn.innerHTML = 'Upload Photo';
            }
        }

        // ==================== ADMIN FUNCTIONS ====================

        // Load admin data
        async function loadAdminData() {
            loadAllUsers();
            loadAllListings();
            loadAllOrders();
            loadPaymentRequests();
            loadWithdrawalRequests();
            loadAdminStats();
            loadSupportContent();
            loadWebsiteInfo();
            loadPaymentSettings();
            loadPlatformSettings();
        }

        // Load all users for admin
        async function loadAllUsers() {
            const usersContainer = document.getElementById('allUsers');
            if (!usersContainer) return;

            try {
                const q = query(collection(db, "users"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                
                usersContainer.innerHTML = "";
                
                if (querySnapshot.empty) {
                    usersContainer.innerHTML = "<p class='no-data'>No users found.</p>";
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const user = doc.data();
                    user.id = doc.id;
                    const userElement = createUserElement(user);
                    usersContainer.appendChild(userElement);
                });
            } catch (error) {
                console.error("Error loading users: ", error);
                usersContainer.innerHTML = "<p class='error'>Error loading users.</p>";
            }
        }

        // Create user element for admin
        function createUserElement(user) {
            const div = document.createElement('div');
            div.className = 'admin-item';
            
            div.innerHTML = `
                <div class="admin-item-header">
                    <span class="user-name">${user.name || 'No Name'}</span>
                    <span class="user-email">${user.email}</span>
                    <span class="user-role ${user.role}">${user.role}</span>
                    <span class="user-status ${user.status}">${user.status}</span>
                </div>
                <div class="admin-item-details">
                    <p><i class="fas fa-wallet"></i> Wallet: ${formatIndianCurrency(user.wallet || 0)}</p>
                    <p><i class="fas fa-phone"></i> Phone: ${user.phone || 'Not set'}</p>
                    <p><i class="fas fa-shield-alt"></i> KYC: ${user.kycVerified ? 'Verified' : 'Not Verified'}</p>
                    <p><i class="fas fa-calendar"></i> Joined: ${user.createdAt?.toDate().toLocaleDateString() || 'N/A'}</p>
                </div>
                <div class="admin-item-actions">
                    <button class="btn-sm btn-edit" onclick="editUser('${user.id}')">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn-sm ${user.status === 'active' ? 'btn-block' : 'btn-unblock'}" 
                            onclick="${user.status === 'active' ? 'blockUser' : 'unblockUser'}('${user.id}')">
                        <i class="fas ${user.status === 'active' ? 'fa-ban' : 'fa-check'}"></i>
                        ${user.status === 'active' ? 'Block' : 'Unblock'}
                    </button>
                    <button class="btn-sm btn-delete" onclick="deleteUser('${user.id}', '${user.uid}')">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            `;
            
            return div;
        }

        // Load all listings for admin
        async function loadAllListings() {
            const listingsContainer = document.getElementById('allListings');
            if (!listingsContainer) return;

            try {
                const q = query(collection(db, "listings"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                
                listingsContainer.innerHTML = "";
                
                if (querySnapshot.empty) {
                    listingsContainer.innerHTML = "<p class='no-data'>No listings found.</p>";
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const listing = doc.data();
                    listing.id = doc.id;
                    const listingElement = createAdminListingElement(listing);
                    listingsContainer.appendChild(listingElement);
                });
            } catch (error) {
                console.error("Error loading listings: ", error);
                listingsContainer.innerHTML = "<p class='error'>Error loading listings.</p>";
            }
        }

        // Create admin listing element
        function createAdminListingElement(listing) {
            const div = document.createElement('div');
            div.className = 'admin-item';
            
            div.innerHTML = `
                <div class="admin-item-header">
                    <span class="listing-handle">@${listing.handle}</span>
                    <span class="listing-platform">${listing.platform}</span>
                    <span class="listing-status ${listing.status.replace(' ', '-')}">${listing.status}</span>
                    <span class="listing-approved ${listing.approved ? 'approved' : 'pending'}">
                        ${listing.approved ? 'Approved' : 'Pending'}
                    </span>
                </div>
                <div class="admin-item-details">
                    <p><i class="fas fa-user"></i> Seller: ${listing.sellerEmail}</p>
                    <p><i class="fas fa-rupee-sign"></i> Price: ${formatIndianCurrency(listing.price)}</p>
                    <p><i class="fas fa-users"></i> Subscribers: ${listing.subscribers}</p>
                    <p><i class="fas fa-calendar"></i> Created: ${listing.createdAt?.toDate().toLocaleDateString() || 'N/A'}</p>
                </div>
                <div class="admin-item-actions">
                    <button class="btn-sm btn-edit" onclick="editListing('${listing.id}')">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn-sm ${listing.approved ? 'btn-reject' : 'btn-approve'}" 
                            onclick="${listing.approved ? 'rejectListing' : 'approveListing'}('${listing.id}')">
                        <i class="fas ${listing.approved ? 'fa-times' : 'fa-check'}"></i>
                        ${listing.approved ? 'Reject' : 'Approve'}
                    </button>
                    <button class="btn-sm btn-featured" onclick="toggleFeatured('${listing.id}', ${listing.featured})">
                        <i class="fas fa-star"></i>
                        ${listing.featured ? 'Unfeature' : 'Feature'}
                    </button>
                    <button class="btn-sm btn-delete" onclick="deleteListing('${listing.id}')">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            `;
            
            return div;
        }

        // Load all orders for admin
        async function loadAllOrders() {
            const ordersContainer = document.getElementById('allOrders');
            if (!ordersContainer) return;

            try {
                const q = query(collection(db, "orders"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                
                ordersContainer.innerHTML = "";
                
                if (querySnapshot.empty) {
                    ordersContainer.innerHTML = "<p class='no-data'>No orders found.</p>";
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const order = doc.data();
                    order.id = doc.id;
                    const orderElement = createAdminOrderElement(order);
                    ordersContainer.appendChild(orderElement);
                });
            } catch (error) {
                console.error("Error loading orders: ", error);
                ordersContainer.innerHTML = "<p class='error'>Error loading orders.</p>";
            }
        }

        // Create admin order element
        function createAdminOrderElement(order) {
            const div = document.createElement('div');
            div.className = 'admin-item';
            
            div.innerHTML = `
                <div class="admin-item-header">
                    <span class="order-handle">@${order.handle}</span>
                    <span class="order-price">${formatIndianCurrency(order.price)}</span>
                    <span class="order-status ${order.status}">${order.status}</span>
                    <span class="payment-status ${order.paymentStatus}">${order.paymentStatus}</span>
                </div>
                <div class="admin-item-details">
                    <p><i class="fas fa-user"></i> Buyer: ${order.buyerEmail}</p>
                    <p><i class="fas fa-hashtag"></i> Order ID: ${order.orderId || order.id}</p>
                    <p><i class="fas fa-calendar"></i> Created: ${order.createdAt?.toDate().toLocaleDateString() || 'N/A'}</p>
                </div>
                <div class="admin-item-actions">
                    <button class="btn-sm btn-view" onclick="viewOrder('${order.id}')">
                        <i class="fas fa-eye"></i> View
                    </button>
                    <button class="btn-sm ${order.paymentStatus === 'Completed' ? 'btn-reject-payment' : 'btn-approve-payment'}" 
                            onclick="${order.paymentStatus === 'Completed' ? 'rejectPayment' : 'approvePayment'}('${order.id}')">
                        <i class="fas ${order.paymentStatus === 'Completed' ? 'fa-times' : 'fa-check'}"></i>
                        ${order.paymentStatus === 'Completed' ? 'Reject Payment' : 'Approve Payment'}
                    </button>
                    <button class="btn-sm btn-complete" onclick="completeOrder('${order.id}')">
                        <i class="fas fa-check-circle"></i> Complete
                    </button>
                    <button class="btn-sm btn-cancel" onclick="cancelOrder('${order.id}')">
                        <i class="fas fa-times-circle"></i> Cancel
                    </button>
                </div>
            `;
            
            return div;
        }

        // Load payment requests
        async function loadPaymentRequests() {
            const container = document.getElementById('paymentRequests');
            if (!container) return;

            try {
                const q = query(collection(db, "paymentRequests"), where("processed", "==", false), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                
                container.innerHTML = "";
                
                if (querySnapshot.empty) {
                    container.innerHTML = "<p class='no-data'>No pending payment requests.</p>";
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const request = doc.data();
                    request.id = doc.id;
                    const element = createPaymentRequestElement(request);
                    container.appendChild(element);
                });
            } catch (error) {
                console.error("Error loading payment requests: ", error);
                container.innerHTML = "<p class='error'>Error loading payment requests.</p>";
            }
        }

        // Create payment request element
        function createPaymentRequestElement(request) {
            const div = document.createElement('div');
            div.className = 'admin-item';
            
            div.innerHTML = `
                <div class="admin-item-header">
                    <span class="user-email">${request.userEmail}</span>
                    <span class="request-amount">${formatIndianCurrency(request.amount)}</span>
                    <span class="request-status ${request.status}">${request.status}</span>
                </div>
                <div class="admin-item-details">
                    <p><i class="fas fa-receipt"></i> UTR: ${request.utr}</p>
                    <p><i class="fas fa-qrcode"></i> UPI: ${request.upiId}</p>
                    <p><i class="fas fa-user"></i> Name: ${request.userName || 'N/A'}</p>
                    <p><i class="fas fa-calendar"></i> Requested: ${request.createdAt?.toDate().toLocaleDateString() || 'N/A'}</p>
                </div>
                <div class="admin-item-actions">
                    <button class="btn-sm btn-approve" onclick="approvePaymentRequest('${request.id}', '${request.userId}', ${request.amount})">
                        <i class="fas fa-check"></i> Approve
                    </button>
                    <button class="btn-sm btn-reject" onclick="rejectPaymentRequest('${request.id}')">
                        <i class="fas fa-times"></i> Reject
                    </button>
                </div>
            `;
            
            return div;
        }

        // Load withdrawal requests
        async function loadWithdrawalRequests() {
            const container = document.getElementById('withdrawalRequests');
            if (!container) return;

            try {
                const q = query(collection(db, "withdrawalRequests"), where("processed", "==", false), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                
                container.innerHTML = "";
                
                if (querySnapshot.empty) {
                    container.innerHTML = "<p class='no-data'>No pending withdrawal requests.</p>";
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const request = doc.data();
                    request.id = doc.id;
                    const element = createWithdrawalRequestElement(request);
                    container.appendChild(element);
                });
            } catch (error) {
                console.error("Error loading withdrawal requests: ", error);
                container.innerHTML = "<p class='error'>Error loading withdrawal requests.</p>";
            }
        }

        // Create withdrawal request element
        function createWithdrawalRequestElement(request) {
            const div = document.createElement('div');
            div.className = 'admin-item';
            
            div.innerHTML = `
                <div class="admin-item-header">
                    <span class="user-email">${request.userEmail}</span>
                    <span class="request-amount">${formatIndianCurrency(request.amount)}</span>
                    <span class="request-status ${request.status}">${request.status}</span>
                </div>
                <div class="admin-item-details">
                    <p><i class="fas fa-qrcode"></i> UPI: ${request.upiId}</p>
                    <p><i class="fas fa-user"></i> Name: ${request.userName || 'N/A'}</p>
                    <p><i class="fas fa-calendar"></i> Requested: ${request.createdAt?.toDate().toLocaleDateString() || 'N/A'}</p>
                </div>
                <div class="admin-item-actions">
                    <button class="btn-sm btn-approve" onclick="approveWithdrawalRequest('${request.id}', '${request.userId}', ${request.amount})">
                        <i class="fas fa-check"></i> Approve
                    </button>
                    <button class="btn-sm btn-reject" onclick="rejectWithdrawalRequest('${request.id}')">
                        <i class="fas fa-times"></i> Reject
                    </button>
                </div>
            `;
            
            return div;
        }

        // Load support content
        async function loadSupportContent() {
            try {
                const docRef = doc(db, "settings", "supportContent");
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    document.getElementById('supportContent').innerHTML = data.content || "<p>No support content available.</p>";
                    document.getElementById('adminSupportContent').value = data.content || "";
                }
            } catch (error) {
                console.error("Error loading support content: ", error);
            }
        }

        // Load website info
        async function loadWebsiteInfo() {
            try {
                const docRef = doc(db, "settings", "websiteInfo");
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    document.getElementById('websiteName').value = data.name || "DG Marketplace";
                    document.getElementById('websiteDescription').value = data.description || "";
                    document.getElementById('adminContactEmail').value = data.contactEmail || "";
                    document.getElementById('adminContactPhone').value = data.contactPhone || "";
                    
                    // Update website title
                    document.title = data.name || "DG Marketplace";
                }
            } catch (error) {
                console.error("Error loading website info: ", error);
            }
        }

        // Load payment settings
        async function loadPaymentSettings() {
            try {
                const docRef = doc(db, "settings", "paymentMethod");
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    document.getElementById('adminUpiId').value = data.upiId || "7775965170@naviaxis";
                }
            } catch (error) {
                console.error("Error loading payment settings: ", error);
            }
        }

        // Load platform settings
        async function loadPlatformSettings() {
            try {
                const docRef = doc(db, "settings", "platformSettings");
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    document.getElementById('platformCommission').value = data.commission || 10;
                    document.getElementById('minListingPrice').value = data.minPrice || 1000;
                }
            } catch (error) {
                console.error("Error loading platform settings: ", error);
            }
        }

        // Save support content
        window.saveSupportContent = async () => {
            const content = document.getElementById('adminSupportContent').value;
            
            try {
                await setDoc(doc(db, "settings", "supportContent"), {
                    content: content,
                    updatedAt: serverTimestamp()
                });
                
                document.getElementById('supportContent').innerHTML = content;
                alert("Support content updated successfully!");
            } catch (error) {
                alert("Error updating support content: " + error.message);
            }
        }

        // Save website info
        window.saveWebsiteInfo = async () => {
            const name = document.getElementById('websiteName').value.trim();
            const description = document.getElementById('websiteDescription').value.trim();
            const contactEmail = document.getElementById('adminContactEmail').value.trim();
            const contactPhone = document.getElementById('adminContactPhone').value.trim();
            
            if (!name) {
                return alert("Website name is required!");
            }
            
            try {
                await setDoc(doc(db, "settings", "websiteInfo"), {
                    name: name,
                    description: description,
                    contactEmail: contactEmail,
                    contactPhone: contactPhone,
                    updatedAt: serverTimestamp()
                });
                
                document.title = name;
                document.querySelector('.logo-text').textContent = name;
                
                alert("Website info updated successfully!");
            } catch (error) {
                alert("Error updating website info: " + error.message);
            }
        }

        // Update payment method
        window.updatePaymentMethod = async () => {
            const upiId = document.getElementById('adminUpiId').value.trim();
            
            if (!upiId) {
                return alert("Please enter UPI ID!");
            }
            
            try {
                await setDoc(doc(db, "settings", "paymentMethod"), {
                    upiId: upiId,
                    updatedAt: serverTimestamp()
                });
                
                alert("Payment method updated successfully!");
            } catch (error) {
                alert("Error updating payment method: " + error.message);
            }
        };

        // Save platform settings
        window.savePlatformSettings = async () => {
            const commission = parseFloat(document.getElementById('platformCommission').value);
            const minPrice = parseFloat(document.getElementById('minListingPrice').value);
            
            if (!commission || commission < 0 || commission > 50) {
                return alert("Please enter a valid commission (0-50%)!");
            }
            
            if (!minPrice || minPrice < 100) {
                return alert("Minimum listing price must be at least â‚¹100!");
            }
            
            try {
                await setDoc(doc(db, "settings", "platformSettings"), {
                    commission: commission,
                    minPrice: minPrice,
                    updatedAt: serverTimestamp()
                });
                
                alert("Platform settings updated successfully!");
            } catch (error) {
                alert("Error updating platform settings: " + error.message);
            }
        };

        // UPLOAD HERO IMAGE Function
        window.uploadHeroImage = async () => {
            const fileInput = document.getElementById('heroImageUpload');
            const file = fileInput.files[0];
            
            if (!file) {
                return alert("Please select an image!");
            }
            
            if (!file.type.startsWith('image/')) {
                return alert("Please select an image file!");
            }
            
            if (file.size > 10 * 1024 * 1024) {
                return alert("Image size should be less than 10MB!");
            }
            
            try {
                const storageRef = ref(storage, `website/hero-image.jpg`);
                await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(storageRef);
                
                await setDoc(doc(db, "settings", "heroImage"), {
                    url: downloadURL,
                    updatedAt: serverTimestamp()
                });
                
                alert("Hero image uploaded successfully!");
                fileInput.value = '';
            } catch (error) {
                alert("Error uploading image: " + error.message);
            }
        };

        // Upload logo
        window.uploadLogo = async () => {
            const fileInput = document.getElementById('logoUpload');
            const file = fileInput.files[0];
            
            if (!file) {
                return alert("Please select an image!");
            }
            
            if (!file.type.startsWith('image/')) {
                return alert("Please select an image file!");
            }
            
            try {
                const storageRef = ref(storage, `website/logo.png`);
                await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(storageRef);
                
                await setDoc(doc(db, "settings", "logo"), {
                    url: downloadURL,
                    updatedAt: serverTimestamp()
                });
                
                alert("Logo uploaded successfully!");
                fileInput.value = '';
            } catch (error) {
                alert("Error uploading logo: " + error.message);
            }
        };

        // Load admin stats
        async function loadAdminStats() {
            try {
                // Total users
                const usersQuery = query(collection(db, "users"));
                const usersSnapshot = await getDocs(usersQuery);
                document.getElementById('totalUsers').textContent = usersSnapshot.size;

                // Total listings
                const listingsQuery = query(collection(db, "listings"));
                const listingsSnapshot = await getDocs(listingsQuery);
                document.getElementById('totalListings').textContent = listingsSnapshot.size;

                // Total orders
                const ordersQuery = query(collection(db, "orders"));
                const ordersSnapshot = await getDocs(ordersQuery);
                document.getElementById('totalOrders').textContent = ordersSnapshot.size;

                // Pending approvals
                const pendingQuery = query(collection(db, "listings"), where("approved", "==", false));
                const pendingSnapshot = await getDocs(pendingQuery);
                document.getElementById('pendingApprovals').textContent = pendingSnapshot.size;

            } catch (error) {
                console.error("Error loading stats: ", error);
            }
        }

        // Admin functions
        window.approveListing = async (listingId) => {
            try {
                await updateDoc(doc(db, "listings", listingId), {
                    approved: true,
                    status: "Available",
                    approvedAt: serverTimestamp()
                });
                alert("Listing approved!");
                loadAllListings();
                loadAdminStats();
            } catch (error) {
                alert("Error approving listing: " + error.message);
            }
        };

        window.rejectListing = async (listingId) => {
            try {
                await updateDoc(doc(db, "listings", listingId), {
                    approved: false,
                    status: "Rejected",
                    rejectedAt: serverTimestamp()
                });
                alert("Listing rejected!");
                loadAllListings();
            } catch (error) {
                alert("Error rejecting listing: " + error.message);
            }
        };

        window.toggleFeatured = async (listingId, currentlyFeatured) => {
            try {
                await updateDoc(doc(db, "listings", listingId), {
                    featured: !currentlyFeatured
                });
                alert(`Listing ${!currentlyFeatured ? 'featured' : 'unfeatured'}!`);
                loadAllListings();
            } catch (error) {
                alert("Error updating listing: " + error.message);
            }
        };

        window.deleteListing = async (listingId) => {
            if (confirm("Are you sure you want to delete this listing?")) {
                try {
                    await deleteDoc(doc(db, "listings", listingId));
                    alert("Listing deleted!");
                    loadAllListings();
                    loadAdminStats();
                } catch (error) {
                    alert("Error deleting listing: " + error.message);
                }
            }
        };

        window.blockUser = async (userId) => {
            try {
                await updateDoc(doc(db, "users", userId), {
                    status: "blocked"
                });
                alert("User blocked!");
                loadAllUsers();
            } catch (error) {
                alert("Error blocking user: " + error.message);
            }
        };

        window.unblockUser = async (userId) => {
            try {
                await updateDoc(doc(db, "users", userId), {
                    status: "active"
                });
                alert("User unblocked!");
                loadAllUsers();
            } catch (error) {
                alert("Error unblocking user: " + error.message);
            }
        };

        window.deleteUser = async (userId, userUid) => {
            if (confirm("Are you sure you want to delete this user? This action cannot be undone.")) {
                try {
                    await deleteDoc(doc(db, "users", userId));
                    
                    const listingsQuery = query(collection(db, "listings"), where("sellerId", "==", userUid));
                    const listingsSnapshot = await getDocs(listingsQuery);
                    listingsSnapshot.forEach(async (listingDoc) => {
                        await deleteDoc(listingDoc.ref);
                    });
                    
                    alert("User deleted!");
                    loadAllUsers();
                    loadAllListings();
                    loadAdminStats();
                } catch (error) {
                    alert("Error deleting user: " + error.message);
                }
            }
        };

        window.approvePayment = async (orderId) => {
            try {
                await updateDoc(doc(db, "orders", orderId), {
                    paymentStatus: "Completed"
                });
                alert("Payment approved!");
                loadAllOrders();
            } catch (error) {
                alert("Error approving payment: " + error.message);
            }
        };

        window.rejectPayment = async (orderId) => {
            try {
                await updateDoc(doc(db, "orders", orderId), {
                    paymentStatus: "Failed"
                });
                alert("Payment rejected!");
                loadAllOrders();
            } catch (error) {
                alert("Error rejecting payment: " + error.message);
            }
        };

        window.completeOrder = async (orderId) => {
            try {
                await updateDoc(doc(db, "orders", orderId), {
                    status: "Completed",
                    completedAt: serverTimestamp()
                });
                alert("Order marked as completed!");
                loadAllOrders();
            } catch (error) {
                alert("Error completing order: " + error.message);
            }
        };

        window.cancelOrder = async (orderId) => {
            try {
                await updateDoc(doc(db, "orders", orderId), {
                    status: "Cancelled",
                    cancelledAt: serverTimestamp()
                });
                alert("Order cancelled!");
                loadAllOrders();
            } catch (error) {
                alert("Error cancelling order: " + error.message);
            }
        };

        window.approvePaymentRequest = async (requestId, userId, amount) => {
            try {
                // Update request status
                await updateDoc(doc(db, "paymentRequests", requestId), {
                    status: "approved",
                    processed: true,
                    processedAt: serverTimestamp()
                });
                
                // Add funds to user's wallet
                const q = query(collection(db, "users"), where("uid", "==", userId));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    querySnapshot.forEach(async (userDoc) => {
                        const user = userDoc.data();
                        const newBalance = (user.wallet || 0) + amount;
                        await updateDoc(doc(db, "users", userDoc.id), {
                            wallet: newBalance
                        });
                    });
                }
                
                alert("Payment approved and funds added to user wallet!");
                loadPaymentRequests();
            } catch (error) {
                alert("Error approving payment: " + error.message);
            }
        };

        window.rejectPaymentRequest = async (requestId) => {
            try {
                await updateDoc(doc(db, "paymentRequests", requestId), {
                    status: "rejected",
                    processed: true,
                    processedAt: serverTimestamp()
                });
                alert("Payment request rejected!");
                loadPaymentRequests();
            } catch (error) {
                alert("Error rejecting payment: " + error.message);
            }
        };

        window.approveWithdrawalRequest = async (requestId, userId, amount) => {
            try {
                // Update request status
                await updateDoc(doc(db, "withdrawalRequests", requestId), {
                    status: "approved",
                    processed: true,
                    processedAt: serverTimestamp()
                });
                
                // Deduct from user's wallet
                const q = query(collection(db, "users"), where("uid", "==", userId));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    querySnapshot.forEach(async (userDoc) => {
                        const user = userDoc.data();
                        const newBalance = (user.wallet || 0) - amount;
                        await updateDoc(doc(db, "users", userDoc.id), {
                            wallet: newBalance
                        });
                    });
                }
                
                alert("Withdrawal approved and funds deducted!");
                loadWithdrawalRequests();
            } catch (error) {
                alert("Error approving withdrawal: " + error.message);
            }
        };

        window.rejectWithdrawalRequest = async (requestId) => {
            try {
                await updateDoc(doc(db, "withdrawalRequests", requestId), {
                    status: "rejected",
                    processed: true,
                    processedAt: serverTimestamp()
                });
                alert("Withdrawal request rejected!");
                loadWithdrawalRequests();
            } catch (error) {
                alert("Error rejecting withdrawal: " + error.message);
            }
        };

        // Admin tab switching
        window.switchAdminTab = (tabName) => {
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.admin-content').forEach(content => {
                content.classList.remove('active');
            });
            
            const clickedTab = document.querySelector(`.admin-tab[onclick="switchAdminTab('${tabName}')"]`);
            if (clickedTab) {
                clickedTab.classList.add('active');
            }
            
            const content = document.getElementById(`${tabName}Tab`);
            if (content) {
                content.classList.add('active');
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            show('login');
            
            document.getElementById('lpass').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
        });
    </script>

    <style>
        /* Professional Color Scheme */
        :root {
            --primary-blue: #1e3c72;
            --secondary-blue: #2a5298;
            --accent-blue: #3498db;
            --light-blue: #85C1E9;
            --white: #ffffff;
            --light-gray: #f8f9fa;
            --medium-gray: #e9ecef;
            --dark-gray: #495057;
            --text-dark: #212529;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.15);
            --shadow-lg: 0 8px 16px rgba(0,0,0,0.2);
            --shadow-xl: 0 12px 24px rgba(0,0,0,0.25);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 25%, var(--accent-blue) 50%, var(--light-blue) 75%, var(--white) 100%);
            color: var(--text-dark);
            min-height: 100vh;
            padding-bottom: 80px;
            line-height: 1.6;
        }

        /* Header */
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--medium-gray);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            font-weight: 700;
            font-size: 24px;
            color: var(--primary-blue);
            transition: var(--transition);
        }

        .logo:hover {
            transform: translateY(-2px);
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, var(--primary-blue), var(--accent-blue));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .logo-text {
            font-weight: 800;
            background: linear-gradient(45deg, var(--primary-blue), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .profile-icon {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-blue), var(--accent-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            overflow: hidden;
        }

        .profile-icon:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }

        .profile-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .menu-btn {
            display: none;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--primary-blue);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .mobile-menu-btn:hover {
            background: var(--light-gray);
        }

        /* Mobile Menu */
        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            width: 280px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 25px rgba(30, 60, 114, 0.2);
            padding: 25px;
            z-index: 1001;
            overflow-y: auto;
            border-left: 5px solid var(--primary-blue);
        }

        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-gray);
        }

        .mobile-menu-header h3 {
            color: var(--primary-blue);
            font-size: 22px;
        }

        .close-menu {
            background: transparent;
            border: none;
            color: var(--accent-blue);
            font-size: 28px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-menu:hover {
            background: var(--light-gray);
        }

        .menu-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .menu-item {
            padding: 15px 20px;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-dark);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 500;
            border: 2px solid transparent;
        }

        .menu-item:hover, .menu-item.active {
            background: linear-gradient(45deg, var(--primary-blue), var(--accent-blue));
            color: white;
            transform: translateX(5px);
            border-color: var(--primary-blue);
        }

        .menu-item i {
            font-size: 20px;
            width: 25px;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--medium-gray);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 999;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 16px;
            color: var(--dark-gray);
            text-decoration: none;
            transition: var(--transition);
            border-radius: var(--radius-md);
        }

        .bottom-nav-item:hover {
            color: var(--primary-blue);
            background: var(--light-gray);
            transform: translateY(-2px);
        }

        .bottom-nav-item.active {
            color: var(--primary-blue);
            background: var(--light-gray);
        }

        .bottom-nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .bottom-nav-text {
            font-size: 12px;
            font-weight: 600;
        }

        /* Cards and Dashboards */
        .card, .dashboard, .role-selector {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 32px;
            margin: 32px auto;
            width: 90%;
            max-width: 500px;
            display: none;
            position: relative;
            z-index: 1;
        }

        .dashboard {
            max-width: 1200px;
        }

        .admin-dashboard {
            max-width: 1400px;
        }

        /* Hero Sections */
        .hero-section {
            text-align: center;
            padding: 32px 24px;
            margin-bottom: 32px;
            background: linear-gradient(135deg, rgba(30, 60, 114, 0.05), rgba(52, 152, 219, 0.05));
            border-radius: var(--radius-xl);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .hero-icon {
            font-size: 64px;
            margin-bottom: 24px;
            display: inline-block;
            animation: float 3s ease-in-out infinite;
            background: linear-gradient(45deg, var(--primary-blue), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .hero-section h1 {
            font-size: 32px;
            margin-bottom: 16px;
            color: var(--primary-blue);
            font-weight: 800;
        }

        .hero-section p {
            color: var(--dark-gray);
            font-size: 18px;
            max-width: 800px;
            margin: 0 auto 24px;
        }

        /* Typography */
        h1, h2, h3 {
            color: var(--primary-blue);
            margin-bottom: 24px;
            font-weight: 700;
        }

        h1 {
            font-size: 28px;
            text-align: center;
        }

        h2 {
            font-size: 24px;
            border-bottom: 2px solid var(--light-gray);
            padding-bottom: 12px;
        }

        h3 {
            font-size: 20px;
            color: var(--secondary-blue);
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark-gray);
            font-weight: 600;
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--medium-gray);
            border-radius: var(--radius-md);
            background: white;
            color: var(--text-dark);
            font-size: 16px;
            transition: var(--transition);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.5;
        }

        /* Buttons */
        button {
            padding: 14px 28px;
            border: none;
            border-radius: var(--radius-md);
            background: linear-gradient(45deg, var(--primary-blue), var(--accent-blue));
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            margin-top: 24px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .secondary-btn {
            background: transparent;
            border: 2px solid var(--accent-blue);
            color: var(--accent-blue);
        }

        .secondary-btn:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .google-btn {
            background: white;
            color: var(--text-dark);
            border: 2px solid var(--medium-gray);
        }

        .google-btn:hover {
            border-color: var(--accent-blue);
            background: var(--light-gray);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
            margin: 5px;
            width: auto;
            border-radius: var(--radius-sm);
        }

        .btn-edit {
            background: linear-gradient(45deg, var(--warning), #ff9800);
        }

        .btn-block {
            background: linear-gradient(45deg, var(--danger), #c0392b);
        }

        .btn-unblock {
            background: linear-gradient(45deg, var(--success), #2ecc71);
        }

        .btn-delete {
            background: linear-gradient(45deg, var(--danger), #c0392b);
        }

        .btn-approve {
            background: linear-gradient(45deg, var(--success), #2ecc71);
        }

        .btn-reject {
            background: linear-gradient(45deg, var(--warning), #f1c40f);
        }

        .btn-featured {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .btn-view {
            background: linear-gradient(45deg, var(--info), #3498db);
        }

        .btn-complete {
            background: linear-gradient(45deg, var(--success), #27ae60);
        }

        .btn-cancel {
            background: linear-gradient(45deg, var(--danger), #e74c3c);
        }

        /* Divider */
        .divider {
            display: flex;
            align-items: center;
            margin: 32px 0;
            color: var(--dark-gray);
        }

        .divider::before, .divider::after {
            content: "";
            flex: 1;
            border-bottom: 1px solid var(--medium-gray);
        }

        .divider span {
            padding: 0 20px;
            background: white;
            font-weight: 500;
            font-size: 14px;
        }

        /* Role Selection */
        .role {
            display: flex;
            justify-content: space-around;
            margin: 25px 0;
        }

        .role label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 15px 25px;
            border-radius: var(--radius-lg);
            transition: var(--transition);
            background: white;
            border: 2px solid var(--medium-gray);
            flex: 1;
            margin: 0 10px;
            justify-content: center;
        }

        .role label:hover {
            border-color: var(--accent-blue);
            background: var(--light-gray);
            transform: translateY(-2px);
        }

        .role input {
            width: auto;
            margin: 0;
        }

        /* Wallet Card */
        .wallet-card {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            padding: 32px;
            border-radius: var(--radius-xl);
            margin: 32px 0;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .wallet-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1%, transparent 1%);
            background-size: 30px 30px;
            animation: floatPattern 20s linear infinite;
        }

        @keyframes floatPattern {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .wallet-balance {
            font-size: 48px;
            font-weight: 800;
            margin: 24px 0;
            position: relative;
            z-index: 1;
        }

        .wallet-actions {
            display: flex;
            gap: 16px;
            margin-top: 24px;
            position: relative;
            z-index: 1;
        }

        .wallet-actions button {
            flex: 1;
            margin: 0;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* Payment QR */
        .payment-info {
            text-align: center;
            padding: 32px;
            background: white;
            border-radius: var(--radius-xl);
            margin: 24px 0;
        }

        .qr-container {
            margin: 24px auto;
            padding: 20px;
            background: white;
            border-radius: var(--radius-lg);
            display: inline-block;
            border: 3px solid var(--primary-blue);
            box-shadow: var(--shadow-md);
        }

        .payment-instructions {
            margin-top: 24px;
            text-align: left;
            background: var(--light-gray);
            padding: 24px;
            border-radius: var(--radius-lg);
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 32px 0;
        }

        .action-card {
            background: white;
            padding: 24px;
            border-radius: var(--radius-lg);
            text-align: center;
            transition: var(--transition);
            border: 2px solid var(--medium-gray);
            cursor: pointer;
        }

        .action-card:hover {
            transform: translateY(-8px);
            border-color: var(--accent-blue);
            box-shadow: var(--shadow-lg);
        }

        .action-card h3 {
            font-size: 18px;
            margin-bottom: 12px;
            color: var(--primary-blue);
        }

        .action-card p {
            color: var(--dark-gray);
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        /* Dashboard Sections */
        .dashboard-section {
            background: white;
            padding: 24px;
            border-radius: var(--radius-lg);
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--medium-gray);
        }

        /* Listings */
        .listings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 24px;
        }

        .listing-card {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--medium-gray);
        }

        .listing-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .listing-image {
            height: 200px;
            background: linear-gradient(45deg, var(--primary-blue), var(--accent-blue));
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .listing-overlay {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 600;
        }

        .listing-details {
            padding: 20px;
        }

        .listing-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .listing-platform {
            display: flex;
            align-items: center;
            gap: 6px;
            background: var(--light-gray);
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
        }

        .listing-category {
            background: var(--accent-blue);
            color: white;
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
        }

        .featured-badge {
            background: linear-gradient(45deg, var(--warning), #ff9800);
            color: white;
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .listing-handle {
            font-size: 20px;
            margin: 12px 0;
            color: var(--primary-blue);
            font-weight: 700;
        }

        .listing-stats {
            display: flex;
            gap: 16px;
            margin: 16px 0;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--dark-gray);
            font-size: 14px;
        }

        .listing-price {
            font-size: 28px;
            font-weight: 800;
            color: var(--primary-blue);
            margin: 16px 0;
        }

        .listing-description {
            color: var(--dark-gray);
            margin: 16px 0;
            line-height: 1.5;
            font-size: 14px;
        }

        .listing-seller {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--dark-gray);
            font-size: 14px;
            margin: 16px 0;
        }

        .listing-actions {
            margin-top: 20px;
        }

        .listing-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 14px;
        }

        .listing-status.under-review {
            background: #fff3cd;
            color: #856404;
        }

        .listing-status.available {
            background: #d4edda;
            color: #155724;
        }

        .listing-status.rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .buy-now-btn {
            width: 100%;
            margin: 0;
            padding: 12px;
            font-size: 14px;
            font-weight: 600;
        }

        /* Profile Section */
        .profile-card {
            background: white;
            padding: 24px;
            border-radius: var(--radius-lg);
            margin: 24px 0;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--medium-gray);
        }

        .profile-info {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light-gray);
        }

        .profile-info p {
            margin: 12px 0;
            color: var(--text-dark);
            font-size: 16px;
        }

        .profile-info strong {
            color: var(--primary-blue);
            display: inline-block;
            width: 150px;
        }

        .profile-photo-upload {
            display: flex;
            align-items: center;
            gap: 24px;
            margin: 24px 0;
        }

        .profile-photo-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-blue), var(--accent-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 24px;
            overflow: hidden;
            border: 4px solid white;
            box-shadow: var(--shadow-md);
        }

        /* Admin Panel */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: var(--radius-lg);
            text-align: center;
            border: 2px solid var(--medium-gray);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .stat-card h3 {
            color: var(--primary-blue);
            -webkit-text-fill-color: var(--primary-blue);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: var(--primary-blue);
            background: linear-gradient(45deg, var(--primary-blue), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .admin-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 15px 30px;
            background: white;
            border: 2px solid var(--medium-gray);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            color: var(--dark-gray);
        }

        .admin-tab:hover, .admin-tab.active {
            background: linear-gradient(45deg, var(--primary-blue), var(--accent-blue));
            color: white;
            border-color: var(--primary-blue);
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .admin-content {
            display: none;
        }

        .admin-content.active {
            display: block;
        }

        .admin-item {
            background: white;
            padding: 25px;
            border-radius: var(--radius-lg);
            margin-bottom: 20px;
            border: 2px solid var(--medium-gray);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .admin-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .admin-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .admin-item-details {
            color: var(--dark-gray);
            margin-bottom: 20px;
            font-size: 15px;
        }

        .admin-item-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .user-name {
            font-weight: bold;
            color: var(--primary-blue);
            font-size: 18px;
        }

        .user-email {
            color: var(--accent-blue);
            font-size: 15px;
        }

        .user-role {
            background: var(--light-gray);
            color: var(--text-dark);
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
        }

        .user-role.Buyer {
            background: var(--accent-blue);
            color: white;
        }

        .user-role.Seller {
            background: var(--warning);
            color: #856404;
        }

        .user-status.active {
            background: var(--success);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .user-status.blocked {
            background: var(--danger);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .listing-approved.approved {
            background: var(--success);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .listing-approved.pending {
            background: var(--warning);
            color: #856404;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .order-status.completed {
            background: var(--success);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .order-status.processing {
            background: var(--warning);
            color: #856404;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .order-status.cancelled {
            background: var(--danger);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .payment-status.completed {
            background: var(--success);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .payment-status.failed {
            background: var(--danger);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .no-listings, .no-data, .error {
            text-align: center;
            padding: 40px;
            color: var(--dark-gray);
            font-size: 18px;
            background: white;
            border-radius: var(--radius-lg);
            border: 2px solid var(--medium-gray);
            box-shadow: var(--shadow-sm);
        }

        .error {
            color: var(--danger);
        }

        /* Support Content */
        .support-content {
            background: white;
            padding: 30px;
            border-radius: var(--radius-lg);
            margin: 25px 0;
            border: 2px solid var(--medium-gray);
            box-shadow: var(--shadow-sm);
        }

        /* Website Images */
        .website-images {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .image-upload-card {
            background: white;
            padding: 25px;
            border-radius: var(--radius-lg);
            text-align: center;
            border: 2px dashed var(--accent-blue);
            transition: var(--transition);
        }

        .image-upload-card:hover {
            border-color: var(--primary-blue);
            transform: translateY(-5px);
        }

        .image-upload-icon {
            font-size: 48px;
            color: var(--accent-blue);
            margin-bottom: 20px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-header {
                padding: 15px;
            }

            .logo-text {
                display: none;
            }

            .menu-btn {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
            }

            .card, .dashboard, .role-selector {
                width: 95%;
                padding: 25px;
                margin: 25px auto 100px;
            }

            .listings-grid {
                grid-template-columns: 1fr;
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }

            .admin-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .admin-item-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .admin-item-actions {
                justify-content: flex-start;
            }

            .wallet-actions {
                flex-direction: column;
            }

            .profile-photo-upload {
                flex-direction: column;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 24px;
            }

            h2 {
                font-size: 20px;
            }

            h3 {
                font-size: 18px;
            }

            .wallet-balance {
                font-size: 36px;
            }

            .hero-icon {
                font-size: 48px;
            }

            .admin-stats {
                grid-template-columns: 1fr;
            }

            .bottom-nav-text {
                font-size: 10px;
            }
        }

        /* Links */
        a {
            color: var(--accent-blue);
            cursor: pointer;
            text-decoration: none;
            font-weight: 500;
        }

        a:hover {
            text-decoration: underline;
            color: var(--primary-blue);
        }

        /* Loading Animation */
        .fa-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="main-header" id="mainHeader" style="display: none;">
        <a href="#" class="logo" onclick="show('buyerDashboard'); return false;">
            <div class="logo-icon">
                <i class="fas fa-store"></i>
            </div>
            <span class="logo-text">DG Marketplace</span>
        </a>
        
        <div class="user-menu">
            <div class="profile-icon" id="profileIcon" onclick="show('profile')">
                <i class="fas fa-user"></i>
            </div>
            <button class="menu-btn" onclick="toggleMenu()">
                <span id="userEmailMenu"></span> <i class="fas fa-chevron-down"></i>
            </button>
            <button class="mobile-menu-btn" id="mobileMenuBtn" onclick="toggleMenu()" style="display: none;">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <h3>Menu</h3>
            <button class="close-menu" onclick="closeMenu()">Ã—</button>
        </div>
        <div class="menu-items">
            <a href="#" class="menu-item" onclick="show('buyerDashboard'); closeMenu();">
                <i class="fas fa-home"></i> Dashboard
            </a>
            <a href="#" class="menu-item" onclick="show('sellerDashboard'); closeMenu();">
                <i class="fas fa-store"></i> Sell Accounts
            </a>
            <a href="#" class="menu-item" onclick="show('walletPage'); closeMenu();">
                <i class="fas fa-wallet"></i> Wallet
            </a>
            <a href="#" class="menu-item" onclick="show('history'); closeMenu();">
                <i class="fas fa-history"></i> History
            </a>
            <a href="#" class="menu-item" onclick="show('profile'); closeMenu();">
                <i class="fas fa-user"></i> Profile
            </a>
            <a href="#" class="menu-item" onclick="show('supportPage'); closeMenu();">
                <i class="fas fa-headset"></i> Support
            </a>
            <div class="divider"></div>
            <a href="#" class="menu-item" onclick="logout(); closeMenu();">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav" id="bottomNav" style="display: none;">
        <a href="#" class="bottom-nav-item" onclick="show('buyerDashboard')">
            <div class="bottom-nav-icon"><i class="fas fa-home"></i></div>
            <div class="bottom-nav-text">Home</div>
        </a>
        <a href="#" class="bottom-nav-item" onclick="show('history')">
            <div class="bottom-nav-icon"><i class="fas fa-history"></i></div>
            <div class="bottom-nav-text">History</div>
        </a>
        <a href="#" class="bottom-nav-item" onclick="show('profile')">
            <div class="bottom-nav-icon"><i class="fas fa-user"></i></div>
            <div class="bottom-nav-text">Profile</div>
        </a>
        <a href="#" class="bottom-nav-item" onclick="show('supportPage')">
            <div class="bottom-nav-icon"><i class="fas fa-headset"></i></div>
            <div class="bottom-nav-text">Support</div>
        </a>
    </div>

    <!-- LOGIN Card -->
    <div class="card" id="login" style="display:block">
        <div class="hero-section">
            <div class="hero-icon">
                <i class="fas fa-store-alt"></i>
            </div>
            <h1>Welcome to DG Marketplace</h1>
            <p>The premier platform for buying and selling verified social media accounts securely</p>
        </div>
        
        <h2>Sign In to Your Account</h2>
        
        <div class="form-group">
            <label for="lmail"><i class="fas fa-envelope"></i> Email Address</label>
            <input id="lmail" type="email" placeholder="Enter your email address">
        </div>
        
        <div class="form-group">
            <label for="lpass"><i class="fas fa-lock"></i> Password</label>
            <input id="lpass" type="password" placeholder="Enter your password">
        </div>
        
        <button onclick="login()">
            <i class="fas fa-sign-in-alt"></i> Sign In
        </button>
        
        <div class="divider">
            <span>Or continue with</span>
        </div>
        
        <button class="google-btn" onclick="googleLogin()">
            <i class="fab fa-google"></i> Continue with Google
        </button>
        
        <p style="text-align: center; margin-top: 24px; color: var(--dark-gray);">
            New to DG Marketplace? 
            <a onclick="show('signup')" style="color: var(--accent-blue); font-weight: 600;">
                Create an account
            </a>
        </p>
    </div>

    <!-- SIGNUP Card -->
    <div class="card" id="signup">
        <div class="hero-section">
            <div class="hero-icon">
                <i class="fas fa-user-plus"></i>
            </div>
            <h1>Join Our Community</h1>
            <p>Start your journey in social media accounts trading with complete security</p>
        </div>
        
        <h2>Create New Account</h2>
        
        <div class="form-group">
            <label for="sname"><i class="fas fa-user"></i> Full Name</label>
            <input id="sname" type="text" placeholder="Enter your full name">
        </div>
        
        <div class="form-group">
            <label for="smail"><i class="fas fa-envelope"></i> Email Address</label>
            <input id="smail" type="email" placeholder="Enter your email address">
        </div>
        
        <div class="form-group">
            <label for="spass"><i class="fas fa-lock"></i> Password</label>
            <input id="spass" type="password" placeholder="Create a strong password (min 6 characters)">
        </div>
        
        <div class="form-group">
            <label>Account Type</label>
            <div class="role">
                <label><input type="radio" name="role" value="Buyer"> <i class="fas fa-shopping-cart"></i> Buyer</label>
                <label><input type="radio" name="role" value="Seller"> <i class="fas fa-store"></i> Seller</label>
            </div>
        </div>
        
        <button onclick="signup()">
            <i class="fas fa-user-plus"></i> Create Account
        </button>
        
        <div class="divider">
            <span>Or sign up with</span>
        </div>
        
        <button class="google-btn" onclick="googleLogin()">
            <i class="fab fa-google"></i> Sign up with Google
        </button>
        
        <p style="text-align: center; margin-top: 24px; color: var(--dark-gray);">
            Already have an account? 
            <a onclick="show('login')" style="color: var(--accent-blue); font-weight: 600;">
                Sign in here
            </a>
        </p>
    </div>

    <!-- ROLE SELECTOR for Google Users -->
    <div class="card role-selector" id="roleSelector">
        <div class="hero-section">
            <div class="hero-icon">
                <i class="fas fa-user-cog"></i>
            </div>
            <h1>Complete Your Profile</h1>
        </div>
        
        <p style="text-align: center; margin-bottom: 20px; color: var(--dark-gray);">
            Please select your role to continue:
        </p>
        
        <div class="role">
            <label><input type="radio" name="googleRole" value="Buyer"> <i class="fas fa-shopping-cart"></i> Buyer</label>
            <label><input type="radio" name="googleRole" value="Seller"> <i class="fas fa-store"></i> Seller</label>
        </div>
        
        <button onclick="saveGoogleUserRole()">
            <i class="fas fa-check-circle"></i> Continue
        </button>
    </div>

    <!-- BUYER DASHBOARD -->
    <div class="dashboard" id="buyerDashboard">
        <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; padding-bottom: 20px; border-bottom: 2px solid var(--light-gray);">
            <div>
                <h1 style="margin: 0; font-size: 24px;">Buy Social Media Accounts</h1>
                <p style="color: var(--dark-gray); margin-top: 8px;">Welcome back, <strong id="buyerEmail"></strong></p>
            </div>
            <span class="listing-category" style="background: var(--accent-blue);">
                <i class="fas fa-user-tag"></i> Buyer Account
            </span>
        </div>
        
        <!-- Wallet Card -->
        <div class="wallet-card">
            <h3 style="color: white; -webkit-text-fill-color: white;">Wallet Balance</h3>
            <div class="wallet-balance"><span id="walletBalance">â‚¹0.00</span></div>
            <p style="color: rgba(255,255,255,0.8); margin-bottom: 24px; position: relative; z-index: 1;">
                <i class="fas fa-wallet"></i> Available for instant purchases
            </p>
            <div class="wallet-actions">
                <button onclick="show('addFundsPage')">
                    <i class="fas fa-plus-circle"></i> Add Funds
                </button>
                <button onclick="show('withdrawPage')" class="secondary-btn">
                    <i class="fas fa-money-bill-wave"></i> Withdraw
                </button>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="dashboard-section">
            <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
            <div class="quick-actions">
                <div class="action-card" onclick="showCategory('Instagram', 'buy')">
                    <div style="font-size: 32px; color: #E1306C; margin-bottom: 12px;">
                        <i class="fab fa-instagram"></i>
                    </div>
                    <h3>Buy Instagram</h3>
                    <p>Purchase verified Instagram accounts with real followers and engagement metrics</p>
                    <button class="secondary-btn" style="margin-top: 12px;">
                        <i class="fas fa-search"></i> Browse Listings
                    </button>
                </div>
                
                <div class="action-card" onclick="showCategory('YouTube', 'buy')">
                    <div style="font-size: 32px; color: #FF0000; margin-bottom: 12px;">
                        <i class="fab fa-youtube"></i>
                    </div>
                    <h3>Buy YouTube</h3>
                    <p>Acquire monetized YouTube channels with subscribers and watch time history</p>
                    <button class="secondary-btn" style="margin-top: 12px;">
                        <i class="fas fa-search"></i> Browse Listings
                    </button>
                </div>
                
                <div class="action-card" onclick="showCategory('Facebook', 'buy')">
                    <div style="font-size: 32px; color: #1877F2; margin-bottom: 12px;">
                        <i class="fab fa-facebook"></i>
                    </div>
                    <h3>Buy Facebook</h3>
                    <p>Get established Facebook pages with active community engagement</p>
                    <button class="secondary-btn" style="margin-top: 12px;">
                        <i class="fas fa-search"></i> Browse Listings
                    </button>
                </div>
                
                <div class="action-card" onclick="showCategory('Telegram', 'buy')">
                    <div style="font-size: 32px; color: #0088cc; margin-bottom: 12px;">
                        <i class="fab fa-telegram"></i>
                    </div>
                    <h3>Buy Telegram</h3>
                    <p>Purchase Telegram channels with active members and engagement rates</p>
                    <button class="secondary-btn" style="margin-top: 12px;">
                        <i class="fas fa-search"></i> Browse Listings
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Featured Listings -->
        <div class="dashboard-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h2 style="margin: 0;"><i class="fas fa-star"></i> Featured Listings</h2>
                <button class="secondary-btn" onclick="loadListings()" style="width: auto; padding: 8px 16px;">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            <div id="listingsContainer" class="listings-grid">
                <div class="no-listings" style="grid-column: 1/-1; text-align: center; padding: 40px;">
                    <i class="fas fa-spinner fa-spin fa-3x" style="color: var(--accent-blue); margin-bottom: 20px;"></i>
                    <h3>Loading Listings...</h3>
                    <p style="color: var(--dark-gray);">Fetching the best social media accounts for you</p>
                </div>
            </div>
        </div>
    </div>

    <!-- SELLER DASHBOARD -->
    <div class="dashboard" id="sellerDashboard">
        <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; padding-bottom: 20px; border-bottom: 2px solid var(--light-gray);">
            <div>
                <h1 style="margin: 0; font-size: 24px;">Sell Social Media Accounts</h1>
                <p style="color: var(--dark-gray); margin-top: 8px;">Welcome back, <strong id="sellerEmail"></strong></p>
            </div>
            <span class="listing-category" style="background: var(--warning); color: #856404;">
                <i class="fas fa-store"></i> Seller Account
            </span>
        </div>
        
        <!-- Quick Actions -->
        <div class="dashboard-section">
            <h2><i class="fas fa-rocket"></i> Quick Start</h2>
            <div class="quick-actions">
                <div class="action-card" onclick="showCategory('Instagram', 'sell')">
                    <div style="font-size: 32px; color: #E1306C; margin-bottom: 12px;">
                        <i class="fab fa-instagram"></i>
                    </div>
                    <h3>Sell Instagram</h3>
                    <p>List your Instagram account with followers, engagement rate, and analytics</p>
                    <button class="secondary-btn" style="margin-top: 12px;">
                        <i class="fas fa-plus"></i> Create Listing
                    </button>
                </div>
                
                <div class="action-card" onclick="showCategory('YouTube', 'sell')">
                    <div style="font-size: 32px; color: #FF0000; margin-bottom: 12px;">
                        <i class="fab fa-youtube"></i>
                    </div>
                    <h3>Sell YouTube</h3>
                    <p>Monetize your YouTube channel by selling it to interested buyers</p>
                    <button class="secondary-btn" style="margin-top: 12px;">
                        <i class="fas fa-plus"></i> Create Listing
                    </button>
                </div>
                
                <div class="action-card" onclick="showCategory('Facebook', 'sell')">
                    <div style="font-size: 32px; color: #1877F2; margin-bottom: 12px;">
                        <i class="fab fa-facebook"></i>
                    </div>
                    <h3>Sell Facebook</h3>
                    <p>Sell your Facebook page with community engagement and post analytics</p>
                    <button class="secondary-btn" style="margin-top: 12px;">
                        <i class="fas fa-plus"></i> Create Listing
                    </button>
                </div>
                
                <div class="action-card" onclick="showCategory('Telegram', 'sell')">
                    <div style="font-size: 32px; color: #0088cc; margin-bottom: 12px;">
                        <i class="fab fa-telegram"></i>
                    </div>
                    <h3>Sell Telegram</h3>
                    <p>List your Telegram channel with member count and engagement metrics</p>
                    <button class="secondary-btn" style="margin-top: 12px;">
                        <i class="fas fa-plus"></i> Create Listing
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Create Listing Form -->
        <div class="dashboard-section" id="sellFormSection">
            <h2><i class="fas fa-plus-circle"></i> Create New Listing</h2>
            <p style="color: var(--dark-gray); margin-bottom: 24px;">Fill out all details accurately to ensure quick approval</p>
            
            <form id="listingForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="category"><i class="fas fa-tag"></i> Category</label>
                        <select id="category" required>
                            <option value="">Select Platform Category</option>
                            <option value="YouTube">YouTube Channel</option>
                            <option value="Instagram">Instagram Account</option>
                            <option value="Facebook">Facebook Page</option>
                            <option value="Telegram">Telegram Channel</option>
                            <option value="TikTok">TikTok Account</option>
                            <option value="Twitter">Twitter Account</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="platform"><i class="fas fa-globe"></i> Platform</label>
                        <select id="platform" required>
                            <option value="">Select Social Platform</option>
                            <option value="YouTube">YouTube</option>
                            <option value="Instagram">Instagram</option>
                            <option value="Facebook">Facebook</option>
                            <option value="Telegram">Telegram</option>
                            <option value="TikTok">TikTok</option>
                            <option value="Twitter">Twitter</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="handle"><i class="fas fa-at"></i> Username/Handle</label>
                        <input id="handle" type="text" placeholder="e.g., @yourchannel" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="subscribers"><i class="fas fa-users"></i> Followers/Subscribers</label>
                        <input id="subscribers" type="number" placeholder="e.g., 10000" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="price"><i class="fas fa-rupee-sign"></i> Listing Price (â‚¹)</label>
                    <input id="price" type="number" placeholder="e.g., 5000" step="100" min="1000" required>
                    <p style="font-size: 12px; color: var(--dark-gray); margin-top: 8px;">
                        <i class="fas fa-info-circle"></i> Minimum listing price: â‚¹1,000
                    </p>
                </div>
                
                <div class="form-group">
                    <label for="description"><i class="fas fa-align-left"></i> Description</label>
                    <textarea id="description" placeholder="Describe your account, niche, engagement rate, monetization status, reason for selling, etc." rows="4"></textarea>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-images"></i> Proof Images (3-7 images required)</label>
                    <div style="margin-bottom: 12px;">
                        <input type="file" id="proofImages" accept="image/*" multiple style="width: 100%; padding: 10px;" onchange="previewImages(this)">
                    </div>
                    <p style="font-size: 12px; color: var(--dark-gray); margin-top: 8px;">
                        <i class="fas fa-lightbulb"></i> Include screenshots of: Analytics dashboard, Subscriber count, Engagement metrics, Ownership proof
                    </p>
                </div>
                
                <button type="button" onclick="createListing()">
                    <i class="fas fa-paper-plane"></i> Submit for Review
                </button>
            </form>
        </div>
        
        <!-- My Listings -->
        <div class="dashboard-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h2 style="margin: 0;"><i class="fas fa-list"></i> My Listings</h2>
                <button class="secondary-btn" onclick="loadMyListings()" style="width: auto; padding: 8px 16px;">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            <div id="myListingsContainer" class="listings-grid">
                <div class="no-listings" style="grid-column: 1/-1; text-align: center; padding: 40px;">
                    <i class="fas fa-plus-circle fa-3x" style="color: var(--accent-blue); margin-bottom: 20px;"></i>
                    <h3>No Listings Yet</h3>
                    <p style="color: var(--dark-gray);">Create your first listing to start selling</p>
                </div>
            </div>
        </div>
    </div>

    <!-- WALLET PAGE -->
    <div class="dashboard" id="walletPage" style="display: none;">
        <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
            <div>
                <h1 style="margin: 0; font-size: 24px;">Your Wallet</h1>
                <p style="color: var(--dark-gray); margin-top: 8px;">Manage your funds securely</p>
            </div>
            <button class="secondary-btn" onclick="show('buyerDashboard')" style="width: auto; padding: 8px 20px;">
                <i class="fas fa-arrow-left"></i> Back
            </button>
        </div>
        
        <div class="wallet-card">
            <h3 style="color: white; -webkit-text-fill-color: white;">Current Balance</h3>
            <div class="wallet-balance"><span id="profileWallet">â‚¹0.00</span></div>
            <p style="color: rgba(255,255,255,0.8); margin-bottom: 24px; position: relative; z-index: 1;">
                <i class="fas fa-wallet"></i> Secure digital wallet
            </p>
            <div class="wallet-actions">
                <button onclick="show('addFundsPage')">
                    <i class="fas fa-plus-circle"></i> Add Funds
                </button>
                <button onclick="show('withdrawPage')" class="secondary-btn">
                    <i class="fas fa-money-bill-wave"></i> Withdraw
                </button>
            </div>
        </div>
        
        <div class="dashboard-section">
            <h3><i class="fas fa-history"></i> Recent Transactions</h3>
            <p style="text-align: center; color: var(--dark-gray); padding: 20px;">Transaction history will be displayed here.</p>
        </div>
    </div>

    <!-- ADD FUNDS PAGE -->
    <div class="dashboard" id="addFundsPage" style="display: none;">
        <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
            <div>
                <h1 style="margin: 0; font-size: 24px;">Add Funds</h1>
                <p style="color: var(--dark-gray); margin-top: 8px;">Add funds using UPI for instant wallet recharge</p>
            </div>
            <button class="secondary-btn" onclick="show('walletPage')" style="width: auto; padding: 8px 20px;">
                <i class="fas fa-arrow-left"></i> Back
            </button>
        </div>
        
        <div class="dashboard-section">
            <label><i class="fas fa-rupee-sign"></i> Amount to Add (â‚¹)</label>
            <input id="addAmount" type="number" placeholder="Enter amount" min="100" step="1">
            <button onclick="addFunds()">
                <i class="fas fa-credit-card"></i> Proceed to Pay
            </button>
        </div>
    </div>

    <!-- PAYMENT PAGE -->
    <div class="dashboard" id="paymentPage" style="display: none;">
        <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
            <div>
                <h1 style="margin: 0; font-size: 24px;">Complete Payment</h1>
                <p style="color: var(--dark-gray); margin-top: 8px;">Secure payment via UPI</p>
            </div>
            <button class="secondary-btn" onclick="show('addFundsPage')" style="width: auto; padding: 8px 20px;">
                <i class="fas fa-arrow-left"></i> Back
            </button>
        </div>
        
        <div class="payment-info">
            <div style="font-size: 48px; color: var(--success); margin-bottom: 16px;">
                <i class="fas fa-qrcode"></i>
            </div>
            <h2>Pay <span id="paymentAmount" style="color: var(--success);">â‚¹0</span></h2>
            <p style="color: var(--dark-gray); margin-bottom: 8px;">To: DG Marketplace</p>
            <p style="background: var(--light-gray); padding: 12px; border-radius: var(--radius-md); font-family: monospace; margin-bottom: 24px;">
                <i class="fas fa-qrcode"></i> UPI ID: <strong id="paymentUpiId">7775965170@naviaxis</strong>
            </p>
            
            <!-- Main Payment QR Code (Your QR) -->
            <div class="qr-container" style="margin-bottom: 30px; text-align: center;">
                <h3 style="color: var(--primary-blue); margin-bottom: 15px;">
                    <i class="fas fa-mobile-alt"></i> Scan QR Code for Payment
                </h3>
                <img src="https://i.ibb.co/Ndmg6PNS/1000018674.jpg" 
                     alt="Payment QR Code" 
                     style="max-width: 250px; height: auto; border: 3px solid var(--primary-blue); border-radius: var(--radius-md); box-shadow: var(--shadow-md);">
                <p style="color: var(--dark-gray); margin-top: 10px; font-size: 14px;">
                    Scan this QR code with any UPI app to complete payment
                </p>
            </div>
            
            <!-- Dynamic QR Code (existing) -->
            <div class="qr-container">
                <h3 style="color: var(--primary-blue); margin-bottom: 15px;">
                    <i class="fas fa-qrcode"></i> Dynamic QR Code
                </h3>
                <canvas id="qrCode"></canvas>
            </div>
            
            <p style="color: var(--dark-gray); margin: 16px 0;">
                <i class="fas fa-mobile-alt"></i> Scan any QR with any UPI app
            </p>
            
            <div class="payment-instructions">
                <h3 style="color: var(--primary-blue); margin-bottom: 16px;">
                    <i class="fas fa-info-circle"></i> Instructions
                </h3>
                <ol style="margin-left: 20px; color: var(--dark-gray);">
                    <li style="margin-bottom: 8px;">Scan QR code with Google Pay, PhonePe, Paytm, or any UPI app</li>
                    <li style="margin-bottom: 8px;">Complete the payment process in your UPI app</li>
                    <li style="margin-bottom: 8px;">Take screenshot of successful payment confirmation</li>
                    <li style="margin-bottom: 8px;">Enter UTR/Transaction ID below for verification</li>
                </ol>
                
                <div class="form-group" style="margin-top: 24px;">
                    <label for="utrNumber"><i class="fas fa-receipt"></i> UTR/Transaction ID</label>
                    <input id="utrNumber" type="text" placeholder="Enter 12-digit UTR number from payment receipt">
                    <p style="font-size: 12px; color: var(--dark-gray); margin-top: 8px;">
                        <i class="fas fa-lightbulb"></i> UTR is provided in payment confirmation message
                    </p>
                </div>
                
                <button onclick="submitPaymentProof()" style="background: var(--success);">
                    <i class="fas fa-check-circle"></i> Submit Payment Proof
                </button>
            </div>
        </div>
    </div>

    <!-- WITHDRAW PAGE -->
    <div class="dashboard" id="withdrawPage" style="display: none;">
        <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
            <div>
                <h1 style="margin: 0; font-size: 24px;">Withdraw Funds</h1>
                <p style="color: var(--dark-gray); margin-top: 8px;">Withdraw your earnings directly to your UPI ID</p>
            </div>
            <button class="secondary-btn" onclick="show('walletPage')" style="width: auto; padding: 8px 20px;">
                <i class="fas fa-arrow-left"></i> Back
            </button>
        </div>
        
        <div class="dashboard-section">
            <label><i class="fas fa-rupee-sign"></i> Amount to Withdraw (â‚¹)</label>
            <input id="withdrawAmount" type="number" placeholder="Enter amount" min="100" step="1">
            
            <label><i class="fas fa-qrcode"></i> Your UPI ID</label>
            <input id="withdrawUpi" type="text" placeholder="Enter your UPI ID (e.g., username@bank)">
            
            <button onclick="withdrawFunds()">
                <i class="fas fa-paper-plane"></i> Request Withdrawal
            </button>
            
            <p style="margin-top: 20px; color: var(--dark-gray); font-size: 14px; padding: 12px; background: var(--light-gray); border-radius: var(--radius-md);">
                <i class="fas fa-info-circle"></i> Note: Withdrawals are processed within 24 hours by admin. Minimum withdrawal: â‚¹100
            </p>
        </div>
    </div>

    <!-- PROFILE PAGE -->
    <div class="dashboard" id="profile" style="display: none;">
        <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
            <div>
                <h1 style="margin: 0; font-size: 24px;">Profile Settings</h1>
                <p style="color: var(--dark-gray); margin-top: 8px;">Manage your account information and preferences</p>
            </div>
            <button class="secondary-btn" onclick="show('buyerDashboard')" style="width: auto; padding: 8px 20px;">
                <i class="fas fa-arrow-left"></i> Back
            </button>
        </div>
        
        <div class="profile-card">
            <div class="profile-info">
                <p><strong><i class="fas fa-envelope"></i> Email:</strong> <span id="profileEmail"></span></p>
                <p><strong><i class="fas fa-user-tag"></i> Role:</strong> <span id="profileRole"></span></p>
                <p><strong><i class="fas fa-wallet"></i> Wallet Balance:</strong> <span id="profileWalletDisplay">â‚¹0.00</span></p>
            </div>
            
            <div class="profile-photo-upload">
                <div class="profile-photo-preview" id="profileIcon">ðŸ‘¤</div>
                <div style="flex: 1;">
                    <label><i class="fas fa-camera"></i> Profile Photo</label>
                    <input type="file" id="profilePhotoUpload" accept="image/*">
                    <button onclick="uploadProfilePhoto()" class="btn-sm">
                        <i class="fas fa-upload"></i> Upload Photo
                    </button>
                </div>
            </div>
            
            <div class="dashboard-section">
                <h3><i class="fas fa-edit"></i> Update Profile</h3>
                <label><i class="fas fa-user"></i> Full Name</label>
                <input id="profileName" type="text" placeholder="Enter your name">
                
                <label><i class="fas fa-phone"></i> Phone Number</label>
                <input id="profilePhone" type="tel" placeholder="Enter phone number">
                
                <button onclick="updateProfile()">
                    <i class="fas fa-save"></i> Update Profile
                </button>
            </div>
        </div>
    </div>

    <!-- HISTORY PAGE -->
    <div class="dashboard" id="history" style="display: none;">
        <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
            <div>
                <h1 style="margin: 0; font-size: 24px;">Transaction History</h1>
                <p style="color: var(--dark-gray); margin-top: 8px;">View all your transactions and activities</p>
            </div>
            <button class="secondary-btn" onclick="show('buyerDashboard')" style="width: auto; padding: 8px 20px;">
                <i class="fas fa-arrow-left"></i> Back
            </button>
        </div>
        
        <div class="dashboard-section">
            <h3><i class="fas fa-history"></i> Your History</h3>
            <p style="text-align: center; color: var(--dark-gray); padding: 40px;">Transaction history will be displayed here.</p>
        </div>
    </div>

    <!-- SUPPORT PAGE -->
    <div class="dashboard" id="supportPage" style="display: none;">
        <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
            <div>
                <h1 style="margin: 0; font-size: 24px;">Support Center</h1>
                <p style="color: var(--dark-gray); margin-top: 8px;">We're here to help you 24/7</p>
            </div>
            <button class="secondary-btn" onclick="show('buyerDashboard')" style="width: auto; padding: 8px 20px;">
                <i class="fas fa-arrow-left"></i> Back
            </button>
        </div>
        
        <div id="supportContent" class="support-content">
            <h3><i class="fas fa-headset"></i> Contact Support</h3>
            <p><i class="fas fa-envelope"></i> Email: support@dgmarketplace.com</p>
            <p><i class="fas fa-phone"></i> Phone: +91 77759 65170</p>
            <p><i class="fas fa-clock"></i> Office Hours: 24/7 Support Available</p>
            <p><i class="fas fa-map-marker-alt"></i> Address: DG Marketplace Headquarters</p>
        </div>
        
        <div class="dashboard-section">
            <h3><i class="fas fa-comments"></i> Send Message</h3>
            <textarea placeholder="Describe your issue..." rows="4"></textarea>
            <button>
                <i class="fas fa-paper-plane"></i> Send Message
            </button>
        </div>
    </div>

    <!-- ADMIN DASHBOARD -->
    <div class="dashboard admin-dashboard" id="adminDashboard">
        <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; padding-bottom: 20px; border-bottom: 2px solid var(--light-gray);">
            <div>
                <h1 style="margin: 0; font-size: 24px;">Admin Panel - Full Control</h1>
                <p style="color: var(--dark-gray); margin-top: 8px;">Welcome Admin, <strong id="adminEmail"></strong></p>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="secondary-btn" onclick="show('buyerDashboard')" style="width: auto; padding: 8px 20px;">
                    <i class="fas fa-eye"></i> View Site
                </button>
                <button class="secondary-btn" onclick="logout()" style="width: auto; padding: 8px 20px;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
        
        <div class="hero-section">
            <div class="hero-icon">
                <i class="fas fa-crown"></i>
            </div>
            <h1>Complete Control Panel</h1>
            <p>Manage users, listings, payments, and platform settings from one dashboard</p>
        </div>
        
        <!-- Admin Stats -->
        <div class="admin-stats">
            <div class="stat-card">
                <h3><i class="fas fa-users"></i> Total Users</h3>
                <div class="stat-number" id="totalUsers">0</div>
            </div>
            <div class="stat-card">
                <h3><i class="fas fa-store"></i> Total Listings</h3>
                <div class="stat-number" id="totalListings">0</div>
            </div>
            <div class="stat-card">
                <h3><i class="fas fa-shopping-cart"></i> Total Orders</h3>
                <div class="stat-number" id="totalOrders">0</div>
            </div>
            <div class="stat-card">
                <h3><i class="fas fa-clock"></i> Pending Approvals</h3>
                <div class="stat-number" id="pendingApprovals">0</div>
            </div>
        </div>
        
        <!-- Admin Tabs -->
        <div class="admin-tabs">
            <div class="admin-tab active" onclick="switchAdminTab('users')">
                <i class="fas fa-users"></i> Users
            </div>
            <div class="admin-tab" onclick="switchAdminTab('listings')">
                <i class="fas fa-store"></i> Listings
            </div>
            <div class="admin-tab" onclick="switchAdminTab('orders')">
                <i class="fas fa-shopping-cart"></i> Orders
            </div>
            <div class="admin-tab" onclick="switchAdminTab('payments')">
                <i class="fas fa-credit-card"></i> Payments
            </div>
            <div class="admin-tab" onclick="switchAdminTab('website')">
                <i class="fas fa-globe"></i> Website
            </div>
            <div class="admin-tab" onclick="switchAdminTab('settings')">
                <i class="fas fa-cog"></i> Settings
            </div>
        </div>
        
        <!-- Users Management -->
        <div class="admin-content active" id="usersTab">
            <h2><i class="fas fa-users"></i> User Management</h2>
            <div id="allUsers">
                <div class="no-data">Loading users...</div>
            </div>
        </div>
        
        <!-- Listings Control -->
        <div class="admin-content" id="listingsTab">
            <h2><i class="fas fa-store"></i> Listings Control</h2>
            <div id="allListings">
                <div class="no-data">Loading listings...</div>
            </div>
        </div>
        
        <!-- Orders Management -->
        <div class="admin-content" id="ordersTab">
            <h2><i class="fas fa-shopping-cart"></i> Orders & Payments</h2>
            <div id="allOrders">
                <div class="no-data">Loading orders...</div>
            </div>
        </div>
        
        <!-- Payment Requests -->
        <div class="admin-content" id="paymentsTab">
            <h2><i class="fas fa-credit-card"></i> Payment Management</h2>
            
            <div class="dashboard-section">
                <h3><i class="fas fa-money-bill-wave"></i> Add Funds Requests</h3>
                <div id="paymentRequests">
                    <div class="no-data">Loading payment requests...</div>
                </div>
            </div>
            
            <div class="dashboard-section">
                <h3><i class="fas fa-wallet"></i> Withdrawal Requests</h3>
                <div id="withdrawalRequests">
                    <div class="no-data">Loading withdrawal requests...</div>
                </div>
            </div>
        </div>
        
        <!-- Website Management -->
        <div class="admin-content" id="websiteTab">
            <h2><i class="fas fa-globe"></i> Website Management</h2>
            
            <div class="dashboard-section">
                <h3><i class="fas fa-info-circle"></i> Website Information</h3>
                <label><i class="fas fa-signature"></i> Website Name</label>
                <input id="websiteName" type="text" placeholder="Enter website name">
                
                <label><i class="fas fa-align-left"></i> Website Description</label>
                <textarea id="websiteDescription" placeholder="Enter website description" rows="3"></textarea>
                
                <label><i class="fas fa-envelope"></i> Contact Email</label>
                <input id="adminContactEmail" type="email" placeholder="Enter contact email">
                
                <label><i class="fas fa-phone"></i> Contact Phone</label>
                <input id="adminContactPhone" type="tel" placeholder="Enter contact phone">
                
                <button onclick="saveWebsiteInfo()">
                    <i class="fas fa-save"></i> Save Website Info
                </button>
            </div>
            
            <div class="website-images">
                <div class="image-upload-card">
                    <div class="image-upload-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <h3>Hero Image</h3>
                    <p>Upload hero image for website</p>
                    <input type="file" id="heroImageUpload" accept="image/*">
                    <button onclick="uploadHeroImage()" class="btn-sm">
                        <i class="fas fa-upload"></i> Upload Image
                    </button>
                </div>
                
                <div class="image-upload-card">
                    <div class="image-upload-icon">
                        <i class="fas fa-palette"></i>
                    </div>
                    <h3>Website Logo</h3>
                    <p>Upload website logo</p>
                    <input type="file" id="logoUpload" accept="image/*">
                    <button onclick="uploadLogo()" class="btn-sm">
                        <i class="fas fa-upload"></i> Upload Logo
                    </button>
                </div>
            </div>
            
            <div class="dashboard-section">
                <h3><i class="fas fa-headset"></i> Support Content</h3>
                <label>Support Page Content (HTML allowed)</label>
                <textarea id="adminSupportContent" rows="10" placeholder="Enter support content..."></textarea>
                <button onclick="saveSupportContent()">
                    <i class="fas fa-save"></i> Save Support Content
                </button>
            </div>
        </div>
        
        <!-- Settings -->
        <div class="admin-content" id="settingsTab">
            <h2><i class="fas fa-cog"></i> Admin Settings</h2>
            
            <div class="dashboard-section">
                <h3><i class="fas fa-credit-card"></i> Payment Settings</h3>
                <label><i class="fas fa-qrcode"></i> Default UPI ID</label>
                <input id="adminUpiId" type="text" placeholder="Enter UPI ID">
                <button onclick="updatePaymentMethod()">
                    <i class="fas fa-save"></i> Update Payment Method
                </button>
            </div>
            
            <div class="dashboard-section">
                <h3><i class="fas fa-chart-line"></i> Platform Settings</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label><i class="fas fa-percentage"></i> Platform Commission (%)</label>
                        <input id="platformCommission" type="number" value="10" min="0" max="50" step="0.1">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-rupee-sign"></i> Minimum Listing Price (â‚¹)</label>
                        <input id="minListingPrice" type="number" value="1000" min="100">
                    </div>
                </div>
                <button onclick="savePlatformSettings()">
                    <i class="fas fa-save"></i> Save Platform Settings
                </button>
            </div>
        </div>
    </div>

    <script>
        // Preview images function
        window.previewImages = (input) => {
            // Simple image count validation
            if (input.files.length < 3) {
                alert("Please select at least 3 proof images!");
                input.value = '';
                return;
            }
            
            if (input.files.length > 7) {
                alert("Maximum 7 images allowed!");
                input.value = '';
                return;
            }
            
            alert(`Selected ${input.files.length} images. Ready to upload!`);
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            show('login');
            
            // Add enter key support for login form
            document.getElementById('lpass').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
        });
    </script>
</body>
</html>
